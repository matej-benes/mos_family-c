{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the MikyOS Family Connect application.",
      "properties": {
        "pin": {
          "type": "string",
          "description": "The user's PIN for logging in. Consider hashing this value for security."
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., 'superadmin', 'starší', 'mladší')."
        },
        "deviceId": {
          "type": "string",
          "description": "The unique ID of the device the user is associated with. (Relationship: User 1:1 Device)"
        },
        "name": {
            "type": "string",
            "description": "The display name of the user."
        },
        "avatarUrl": {
            "type": "string",
            "description": "URL for the user's avatar image."
        },
        "dataAiHint": {
            "type": "string",
            "description": "Hint for AI image generation for the avatar."
        },
        "bedtime": {
            "type": "string",
            "description": "Bedtime for the user in HH:mm format."
        }
      },
      "required": [
        "pin",
        "role",
        "name",
        "deviceId"
      ]
    },
    "Device": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Device",
      "type": "object",
      "description": "Represents a device within the MikyOS Family Connect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Device entity."
        },
        "role": {
          "type": "string",
          "description": "The role associated with the device ('mladší' or 'starší')."
        },
        "bedtime": {
          "type": "string",
          "description": "Timestamp indicating the bedtime for the device.",
          "format": "date-time"
        },
        "approvals": {
          "type": "string",
          "description": "Json string of approved apps and contacts. Stored as a JSON string. {apps:[], contacts:[]}}"
        }
      },
      "required": [
        "id",
        "role",
        "bedtime",
        "approvals"
      ]
    },
    "GameState": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameState",
      "type": "object",
      "description": "Represents the current game state of the application.",
      "properties": {
        "mode": {
          "type": "string",
          "description": "The current game mode ('hraje_se' or 'nehraje_se')."
        }
      },
      "required": [
        "mode"
      ]
    },
    "Call": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Call",
      "type": "object",
      "description": "Represents a WebRTC call signaling document.",
      "properties": {
        "callerId": { "type": "string" },
        "calleeId": { "type": "string" },
        "callerName": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "answered", "declined", "ended"] },
        "offer": { "type": "object" },
        "answer": { "type": "object" }
      },
      "required": ["callerId", "calleeId", "callerName", "status"]
    },
    "IceCandidate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "IceCandidate",
      "type": "object",
      "description": "Represents a WebRTC ICE candidate. The schema is flexible as it's defined by the browser's WebRTC implementation.",
      "properties": {}
    }
  },
  "auth": {
    "providers": [
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information, including PIN (consider hashing!), role, and associated deviceId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/devices/{deviceId}",
        "definition": {
          "entityName": "Device",
          "schema": {
            "$ref": "#/backend/entities/Device"
          },
          "description": "Stores device information, including role, bedtime, and approved apps/contacts.",
          "params": [
            {
              "name": "deviceId",
              "description": "The unique identifier for the device."
            }
          ]
        }
      },
      {
        "path": "/gameState/global",
        "definition": {
          "entityName": "GameState",
          "schema": {
            "$ref": "#/backend/entities/GameState"
          },
          "description": "Stores the global game state, including the current mode."
        }
      },
      {
        "path": "/calls/{callId}",
        "definition": {
          "entityName": "Call",
          "schema": { "$ref": "#/backend/entities/Call" },
          "description": "Stores WebRTC signaling data for calls.",
           "params": [{ "name": "callId", "description": "The unique identifier for the call." }]
        }
      },
      {
        "path": "/calls/{callId}/callerCandidates/{candidateId}",
        "definition": {
          "entityName": "IceCandidate",
          "schema": { "$ref": "#/backend/entities/IceCandidate" },
          "description": "ICE candidates from the caller.",
          "params": [
              { "name": "callId", "description": "The unique identifier for the call." },
              { "name": "candidateId", "description": "The unique identifier for the ICE candidate." }
            ]
        }
      },
      {
        "path": "/calls/{callId}/calleeCandidates/{candidateId}",
        "definition": {
          "entityName": "IceCandidate",
          "schema": { "$ref": "#/backend/entities/IceCandidate" },
          "description": "ICE candidates from the callee.",
          "params": [
            { "name": "callId", "description": "The unique identifier for the call." },
            { "name": "candidateId", "description": "The unique identifier for the ICE candidate." }
          ]
        }
      }
    ]
  }
}
