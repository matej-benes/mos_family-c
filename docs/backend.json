{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account. Each user can be associated with multiple physical devices via the deviceIds property. Authentication for a user is handled via a PIN on a specific device.",
      "properties": {
        "pin": {
          "type": "string",
          "description": "The user's PIN for logging in. Consider hashing this value for security."
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., 'superadmin', 'starší', 'mladší')."
        },
        "deviceIds": {
          "type": "array",
          "description": "The unique IDs of the devices the user is associated with.",
          "items": { "type": "string" }
        },
        "name": {
            "type": "string",
            "description": "The display name of the user."
        },
        "avatarUrl": {
            "type": "string",
            "description": "URL for the user's avatar image."
        },
        "dataAiHint": {
            "type": "string",
            "description": "Hint for AI image generation for the avatar."
        },
        "bedtime": {
            "type": "string",
            "description": "Bedtime for the user in HH:mm format."
        },
        "approvals": {
          "type": "object",
          "description": "Approved apps and contacts for the user.",
          "properties": {
            "apps": {
              "type": "array",
              "description": "List of approved application names.",
              "items": { "type": "string" }
            },
            "contacts": {
              "type": "array",
              "description": "List of approved contact names.",
              "items": { "type": "string" }
            }
          }
        },
        "isManuallyLocked": {
            "type": "boolean",
            "description": "Whether the user is manually locked out by an admin."
        },
        "manualLockMessage": {
            "type": "string",
            "description": "The message to display when the user is manually locked out."
        }
      },
      "required": [
        "pin",
        "role",
        "name"
      ]
    },
    "Device": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Device",
      "type": "object",
      "description": "Represents a device within the MikyOS Family Connect application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Device entity. This should match one of the deviceIds on the User entity."
        }
      },
      "required": [
        "id"
      ]
    },
    "GameState": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameState",
      "type": "object",
      "description": "Represents the current game state of the application.",
      "properties": {
        "mode": {
          "type": "string",
          "description": "The current game mode ('hraje_se' or 'nehraje_se')."
        }
      },
      "required": [
        "mode"
      ]
    },
    "Call": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Call",
      "type": "object",
      "description": "Represents a WebRTC call signaling document.",
      "properties": {
        "callerId": { "type": "string" },
        "calleeId": { "type": "string" },
        "callerName": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "answered", "declined", "ended"] },
        "offer": { "type": "object" },
        "answer": { "type": "object" }
      },
      "required": ["callerId", "calleeId", "callerName", "status"]
    },
    "IceCandidate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "IceCandidate",
      "type": "object",
      "description": "Represents a WebRTC ICE candidate. The schema is flexible as it's defined by the browser's WebRTC implementation.",
      "properties": {}
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a private conversation between two or more users.",
      "properties": {
        "participants": {
          "type": "array",
          "description": "An array of user IDs participating in the chat.",
          "items": { "type": "string" }
        },
        "lastMessage": {
          "type": "object",
          "description": "A summary of the last message for quick display.",
          "properties": {
            "text": { "type": "string" },
            "senderId": { "type": "string" },
            "timestamp": { "type": "object", "description": "Firestore server timestamp." }
          }
        }
      },
      "required": ["participants"]
    },
    "Message": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Message",
        "type": "object",
        "description": "Represents a single message within a chat.",
        "properties": {
            "text": { "type": "string" },
            "senderId": { "type": "string" },
            "timestamp": { "type": "object", "description": "Firestore server timestamp." }
        },
        "required": ["text", "senderId", "timestamp"]
    },
    "Settings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Settings",
      "type": "object",
      "description": "Global application settings.",
      "properties": {
        "wallpaperUrl": {
          "type": "string",
          "description": "URL for the global background wallpaper."
        }
      }
    }
  },
  "auth": {
    "providers": [
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information, including PIN (consider hashing!), role, and associated deviceId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/devices/{deviceId}",
        "definition": {
          "entityName": "Device",
          "schema": {
            "$ref": "#/backend/entities/Device"
          },
          "description": "Stores device-specific information, like approved apps and contacts.",
          "params": [
            {
              "name": "deviceId",
              "description": "The unique identifier for the device."
            }
          ]
        }
      },
      {
        "path": "/gameState/global",
        "definition": {
          "entityName": "GameState",
          "schema": {
            "$ref": "#/backend/entities/GameState"
          },
          "description": "Stores the global game state, including the current mode."
        }
      },
      {
        "path": "/calls/{callId}",
        "definition": {
          "entityName": "Call",
          "schema": { "$ref": "#/backend/entities/Call" },
          "description": "Stores WebRTC signaling data for calls.",
           "params": [{ "name": "callId", "description": "The unique identifier for the call." }]
        }
      },
      {
        "path": "/calls/{callId}/callerCandidates/{candidateId}",
        "definition": {
          "entityName": "IceCandidate",
          "schema": { "$ref": "#/backend/entities/IceCandidate" },
          "description": "ICE candidates from the caller.",
          "params": [
              { "name": "callId", "description": "The unique identifier for the call." },
              { "name": "candidateId", "description": "The unique identifier for the ICE candidate." }
            ]
        }
      },
      {
        "path": "/calls/{callId}/calleeCandidates/{candidateId}",
        "definition": {
          "entityName": "IceCandidate",
          "schema": { "$ref": "#/backend/entities/IceCandidate" },
          "description": "ICE candidates from the callee.",
          "params": [
            { "name": "callId", "description": "The unique identifier for the call." },
            { "name": "candidateId", "description": "The unique identifier for the ICE candidate." }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": { "$ref": "#/backend/entities/Chat" },
          "description": "Stores metadata for a chat session.",
          "params": [{ "name": "chatId", "description": "The unique identifier for the chat." }]
        }
      },
      {
          "path": "/chats/{chatId}/messages/{messageId}",
          "definition": {
              "entityName": "Message",
              "schema": { "$ref": "#/backend/entities/Message" },
              "description": "Stores messages for a specific chat.",
              "params": [
                  { "name": "chatId", "description": "The unique identifier for the chat." },
                  { "name": "messageId", "description": "The unique identifier for the message." }
              ]
          }
      },
      {
        "path": "/settings/global",
        "definition": {
          "entityName": "Settings",
          "schema": {
            "$ref": "#/backend/entities/Settings"
          },
          "description": "Stores global application settings like the wallpaper."
        }
      }
    ]
  }
}
